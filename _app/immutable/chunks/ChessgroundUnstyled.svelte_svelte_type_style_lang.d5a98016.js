import{S as yn,i as Pn,s as kn,k as Cn,l as Sn,m as Mn,h as ve,n as be,b as xn,I as we,o as An,w as Dn}from"./index.c4ce2bd6.js";const On=["white","black"],ce=["a","b","c","d","e","f","g","h"],le=["1","2","3","4","5","6","7","8"],Tn=[...le].reverse(),se=Array.prototype.concat(...ce.map(e=>le.map(n=>e+n))),O=e=>se[8*e[0]+e[1]],w=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Te=se.map(w);function _n(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const qn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},ae=e=>e==="white"?"black":"white",Y=(e,n)=>{const o=e[0]-n[0],r=e[1]-n[1];return o*o+r*r},re=(e,n)=>e.role===n.role&&e.color===n.color,Q=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],q=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},_e=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},de=(e,n)=>{e.style.visibility=n?"visible":"hidden"},j=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},qe=e=>e.buttons===2||e.button===2,N=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Ne(e,n,o){const r=w(e);return n||(r[0]=7-r[0],r[1]=7-r[1]),[o.left+o.width*r[0]/8+o.width/16,o.top+o.height*(7-r[1])/8+o.height/16]}const V=(e,n)=>Math.abs(e-n),Nn=e=>(n,o,r,i)=>V(n,r)<2&&(e==="white"?i===o+1||o<=1&&i===o+2&&n===r:i===o-1||o>=6&&i===o-2&&n===r),Ke=(e,n,o,r)=>{const i=V(e,o),t=V(n,r);return i===1&&t===2||i===2&&t===1},Ee=(e,n,o,r)=>V(e,o)===V(n,r),Ie=(e,n,o,r)=>e===o||n===r,Le=(e,n,o,r)=>Ee(e,n,o,r)||Ie(e,n,o,r),Kn=(e,n,o)=>(r,i,t,c)=>V(r,t)<2&&V(i,c)<2||o&&i===c&&i===(e==="white"?0:7)&&(r===4&&(t===2&&n.includes(0)||t===6&&n.includes(7))||n.includes(t));function En(e,n){const o=n==="white"?"1":"8",r=[];for(const[i,t]of e)i[1]===o&&t.color===n&&t.role==="rook"&&r.push(w(i)[0]);return r}function Re(e,n,o){const r=e.get(n);if(!r)return[];const i=w(n),t=r.role,c=t==="pawn"?Nn(r.color):t==="knight"?Ke:t==="bishop"?Ee:t==="rook"?Ie:t==="queen"?Le:Kn(r.color,En(e,r.color),o);return Te.filter(s=>(i[0]!==s[0]||i[1]!==s[1])&&c(i[0],i[1],s[0],s[1])).map(O)}function k(e,...n){e&&setTimeout(()=>e(...n),1)}function In(e){e.orientation=ae(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ln(e,n){for(const[o,r]of n)r?e.pieces.set(o,r):e.pieces.delete(o)}function Rn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,r]of e.pieces)r.role==="king"&&r.color===n&&(e.check=o)}function Wn(e,n,o,r){R(e),e.premovable.current=[n,o],k(e.premovable.events.set,n,o,r)}function L(e){e.premovable.current&&(e.premovable.current=void 0,k(e.premovable.events.unset))}function Bn(e,n,o){L(e),e.predroppable.current={role:n,key:o},k(e.predroppable.events.set,n,o)}function R(e){const n=e.predroppable;n.current&&(n.current=void 0,k(n.events.unset))}function Hn(e,n,o){if(!e.autoCastle)return!1;const r=e.pieces.get(n);if(!r||r.role!=="king")return!1;const i=w(n),t=w(o);if(i[1]!==0&&i[1]!==7||i[1]!==t[1])return!1;i[0]===4&&!e.pieces.has(o)&&(t[0]===6?o=O([7,t[1]]):t[0]===2&&(o=O([0,t[1]])));const c=e.pieces.get(o);return!c||c.color!==r.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),i[0]<t[0]?(e.pieces.set(O([6,t[1]]),r),e.pieces.set(O([5,t[1]]),c)):(e.pieces.set(O([2,t[1]]),r),e.pieces.set(O([3,t[1]]),c)),!0)}function We(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);if(n===o||!r)return!1;const t=i&&i.color!==r.color?i:void 0;return o===e.selected&&_(e),k(e.events.move,n,o,t),Hn(e,n,o)||(e.pieces.set(o,r),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,k(e.events.change),t||!0}function ue(e,n,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return k(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,k(e.events.change),e.movable.dests=void 0,e.turnColor=ae(e.turnColor),!0}function Be(e,n,o){const r=We(e,n,o);return r&&(e.movable.dests=void 0,e.turnColor=ae(e.turnColor),e.animation.current=void 0),r}function He(e,n,o){if(fe(e,n,o)){const r=Be(e,n,o);if(r){const i=e.hold.stop();_(e);const t={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(t.captured=r),k(e.movable.events.after,n,o,t),!0}}else if(jn(e,n,o))return Wn(e,n,o,{ctrlKey:e.stats.ctrlKey}),_(e),!0;return _(e),!1}function Ve(e,n,o,r){const i=e.pieces.get(n);i&&(Vn(e,n,o)||r)?(e.pieces.delete(n),ue(e,i,o,r),k(e.movable.events.afterNewPiece,i.role,o,{premove:!1,predrop:!1})):i&&zn(e,n,o)?Bn(e,i.role,o):(L(e),R(e)),e.pieces.delete(n),_(e)}function ie(e,n,o){if(k(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){_(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&He(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(ze(e,n)||pe(e,n))&&(je(e,n),e.hold.start())}function je(e,n){e.selected=n,pe(e,n)?e.premovable.dests=Re(e.pieces,n,e.premovable.castle):e.premovable.dests=void 0}function _(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ze(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const fe=(e,n,o)=>{var r,i;return n!==o&&ze(e,n)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(n))===null||i===void 0)&&i.includes(o)))};function Vn(e,n,o){const r=e.pieces.get(n);return!!r&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function pe(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}const jn=(e,n,o)=>n!==o&&pe(e,n)&&Re(e.pieces,n,e.premovable.castle).includes(o);function zn(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Fn(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function Zn(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],r=n[1];let i=!1;if(fe(e,o,r)){const t=Be(e,o,r);if(t){const c={premove:!0};t!==!0&&(c.captured=t),k(e.movable.events.after,o,r,c),i=!0}}return L(e),i}function Un(e,n){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(n(o)){const i={role:o.role,color:e.movable.color};ue(e,i,o.key)&&(k(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return R(e),r}function he(e){L(e),R(e),_(e)}function ye(e){e.movable.color=e.movable.dests=e.animation.current=void 0,he(e)}function z(e,n,o){let r=Math.floor(8*(e[0]-o.left)/o.width);n||(r=7-r);let i=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(i=7-i),r>=0&&r<8&&i>=0&&i<8?O([r,i]):void 0}function Gn(e,n,o,r){const i=w(e),t=Te.filter(l=>Le(i[0],i[1],l[0],l[1])||Ke(i[0],i[1],l[0],l[1])),s=t.map(l=>Ne(O(l),o,r)).map(l=>Y(n,l)),[,a]=s.reduce((l,g,u)=>l[0]<g?l:[g,u],[s[0],0]);return O(t[a])}const C=e=>e.orientation==="white",Fe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Xn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Yn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Ze(e){e==="start"&&(e=Fe);const n=new Map;let o=7,r=0;for(const i of e)switch(i){case" ":case"[":return n;case"/":if(--o,o<0)return n;r=0;break;case"~":{const t=n.get(O([r-1,o]));t&&(t.promoted=!0);break}default:{const t=i.charCodeAt(0);if(t<57)r+=t-48;else{const c=i.toLowerCase();n.set(O([r,o]),{role:Xn[c],color:i===c?"black":"white"}),++r}}}return n}function Qn(e){return Tn.map(n=>ce.map(o=>{const r=e.get(o+n);if(r){let i=Yn[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function Ue(e,n){n.animation&&(ge(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ge(e,n){var o,r,i;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=n.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),ge(e,n),n.fen&&(e.pieces=Ze(n.fen),e.drawable.shapes=((i=n.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in n&&Rn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&je(e,e.selected),Ue(e,n),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",c="e"+t,s=e.movable.dests.get(c),a=e.pieces.get(c);if(!s||!a||a.role!=="king")return;e.movable.dests.set(c,s.filter(l=>!(l==="a"+t&&s.includes("c"+t))&&!(l==="h"+t&&s.includes("g"+t))))}}function ge(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Pe(e[o])&&Pe(n[o])?ge(e[o],n[o]):e[o]=n[o])}function Pe(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const H=(e,n)=>n.animation.enabled?eo(e,n):E(e,n);function E(e,n){const o=e(n);return n.dom.redraw(),o}const ee=(e,n)=>({key:e,pos:w(e),piece:n}),Jn=(e,n)=>n.sort((o,r)=>Y(e.pos,o.pos)-Y(e.pos,r.pos))[0];function $n(e,n){const o=new Map,r=[],i=new Map,t=[],c=[],s=new Map;let a,l,g;for(const[u,b]of e)s.set(u,ee(u,b));for(const u of se)a=n.pieces.get(u),l=s.get(u),a?l?re(a,l.piece)||(t.push(l),c.push(ee(u,a))):c.push(ee(u,a)):l&&t.push(l);for(const u of c)l=Jn(u,t.filter(b=>re(u.piece,b.piece))),l&&(g=[l.pos[0]-u.pos[0],l.pos[1]-u.pos[1]],o.set(u.key,g.concat(g)),r.push(l.key));for(const u of t)r.includes(u.key)||i.set(u.key,u.piece);return{anims:o,fadings:i}}function Xe(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(n-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=no(r);for(const t of o.plan.anims.values())t[2]=t[0]*i,t[3]=t[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((t=performance.now())=>Xe(e,t))}}function eo(e,n){const o=new Map(n.pieces),r=e(n),i=$n(o,n);if(i.anims.size||i.fadings.size){const t=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:i},t||Xe(n,performance.now())}else n.dom.redraw();return r}const no=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,oo=["green","red","blue","yellow"];function ro(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?_(e):he(e);const o=j(n),r=z(o,C(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:o,brush:lo(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Ye(e))}function Ye(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=z(n.pos,C(e),e.dom.bounds());o||(n.snapToValidMove=!1);const r=n.snapToValidMove?Gn(n.orig,n.pos,C(e),e.dom.bounds()):o;r!==n.mouseSq&&(n.mouseSq=r,n.dest=r!==n.orig?r:void 0,e.dom.redrawNow()),Ye(e)}})}function io(e,n){e.drawable.current&&(e.drawable.current.pos=j(n))}function to(e){const n=e.drawable.current;n&&(n.mouseSq&&so(e.drawable,n),Qe(e))}function Qe(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function co(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Je(e.drawable))}function lo(e){var n;const o=(e.shiftKey||e.ctrlKey)&&qe(e),r=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return oo[(o?1:0)+(r?2:0)]}function so(e,n){const o=i=>i.orig===n.orig&&i.dest===n.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(i=>!o(i))),(!r||r.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),Je(e)}function Je(e){e.onChange&&e.onChange(e.shapes)}function ao(e,n){if(!n.isTrusted||n.button!==void 0&&n.button!==0||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),r=j(n),i=z(r,C(e),o);if(!i)return;const t=e.pieces.get(i),c=e.selected;!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!t||t.color!==e.turnColor)&&co(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||t||c||uo(e,r))&&n.preventDefault();const s=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&fe(e,e.selected,i)?H(u=>ie(u,i),e):ie(e,i);const l=e.selected===i,g=en(e,i);if(t&&g&&l&&Fn(e,i)){e.draggable.current={orig:i,piece:t,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:g,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},g.cgDragging=!0,g.classList.add("dragging");const u=e.dom.elements.ghost;u&&(u.className=`ghost ${t.color} ${t.role}`,q(u,Q(o)(w(i),C(e))),de(u,!0)),me(e)}else s&&L(e),a&&R(e);e.dom.redraw()}function uo(e,n){const o=C(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const t of e.pieces.keys()){const c=Ne(t,o,r);if(Y(c,n)<=i)return!0}return!1}function fo(e,n,o,r){const i="a0";e.pieces.set(i,n),e.dom.redraw();const t=j(o);e.draggable.current={orig:i,piece:n,origPos:t,pos:t,started:!0,element:()=>en(e,i),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},me(e)}function me(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!re(r,o.piece))J(e);else if(!o.started&&Y(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const t=o.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),o.element=t}const i=e.dom.bounds();q(o.element,[o.pos[0]-i.left-i.width/16,o.pos[1]-i.top-i.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==z(o.pos,C(e),i))}me(e)})}function po(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=j(n))}function ho(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}L(e),R(e);const r=j(n)||o.pos,i=z(r,C(e),e.dom.bounds());i&&o.started&&o.orig!==i?o.newPiece?Ve(e,o.orig,i,o.force):(e.stats.ctrlKey=n.ctrlKey,He(e,o.orig,i)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(o.orig),k(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===i||!i)?_(e):e.selectable.enabled||_(e),$e(e),e.draggable.current=void 0,e.dom.redraw()}function J(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,_(e),$e(e),e.dom.redraw())}function $e(e){const n=e.dom.elements;n.ghost&&de(n.ghost,!1)}function en(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function go(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{ke(e,2),setTimeout(()=>ke(e,void 0),120)},120)}function ke(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function mo(e,n){function o(){In(e),n()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),Ue(e,r),(r.fen?H:E)(i=>Ge(i,r),e)},state:e,getFen:()=>Qn(e.pieces),toggleOrientation:o,setPieces(r){H(i=>Ln(i,r),e)},selectSquare(r,i){r?H(t=>ie(t,r,i),e):e.selected&&(_(e),e.dom.redraw())},move(r,i){H(t=>We(t,r,i),e)},newPiece(r,i){H(t=>ue(t,r,i),e)},playPremove(){if(e.premovable.current){if(H(Zn,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=Un(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){E(L,e)},cancelPredrop(){E(R,e)},cancelMove(){E(r=>{he(r),J(r)},e)},stop(){E(r=>{ye(r),J(r)},e)},explode(r){go(e,r)},setAutoShapes(r){E(i=>i.drawable.autoShapes=r,e)},setShapes(r){E(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return z(r,C(e),e.dom.bounds())},redrawAll:n,dragNewPiece(r,i,t){fo(e,r,i,t)},destroy(){ye(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function vo(){return{pieces:Ze(Fe),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:qn()}}function te(e,n,o){const r=new Map,i=[];for(const s of e)r.set(s.hash,!1);let t=n.firstChild,c;for(;t;)c=t.getAttribute("cgHash"),r.has(c)?r.set(c,!0):i.push(t),t=t.nextSibling;for(const s of i)n.removeChild(s);for(const s of e)r.get(s.hash)||n.appendChild(o(s))}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function bo(e,n,o){const r=e.drawable,i=r.current,t=i&&i.mouseSq?i:void 0,c=new Map,s=e.dom.bounds(),a=r.autoShapes.filter(f=>!f.piece);for(const f of r.shapes.concat(a).concat(t?[t]:[]))f.dest&&c.set(f.dest,(c.get(f.dest)||0)+1);const l=r.shapes.concat(a).map(f=>({shape:f,current:!1,hash:Ce(f,c,!1,s)}));t&&l.push({shape:t,current:!0,hash:Ce(t,c,!0,s)});const g=l.map(f=>f.hash).join(";");if(g===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=g;const u=n.querySelector("defs"),b=n.querySelector("g"),S=o.querySelector("g");wo(r,l,u),te(l.filter(f=>!f.shape.customSvg),b,f=>Se(e,f,r.brushes,c,s)),te(l.filter(f=>f.shape.customSvg),S,f=>Se(e,f,r.brushes,c,s))}function wo(e,n,o){var r;const i=new Map;let t;for(const a of n)a.shape.dest&&(t=e.brushes[a.shape.brush],a.shape.modifiers&&(t=nn(t,a.shape.modifiers)),!((r=a.shape.modifiers)===null||r===void 0)&&r.hilite&&i.set("hilite",{key:"hilite",color:"white",opacity:1,lineWidth:1}),i.set(t.key,t));const c=new Set;let s=o.firstChild;for(;s;)c.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[a,l]of i.entries())c.has(a)||o.appendChild(xo(l))}function Ce({orig:e,dest:n,brush:o,piece:r,modifiers:i,customSvg:t},c,s,a){return[a.width,a.height,s,e,n,o,n&&(c.get(n)||0)>1,r&&yo(r),i&&Po(i),t&&ko(t)].filter(l=>l).join(",")}function yo(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function Po(e){return[e.lineWidth,e.hilite].filter(n=>n).join(",")}function ko(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return"custom-"+n.toString()}function Se(e,{shape:n,current:o,hash:r},i,t,c){var s;let a;const l=Me(w(n.orig),e.orientation);if(n.customSvg)a=Co(n.customSvg,l,c);else if(n.dest){let g=i[n.brush];n.modifiers&&(g=nn(g,n.modifiers)),a=Mo(g,l,Me(w(n.dest),e.orientation),o,(t.get(n.dest)||0)>1,c,(s=n.modifiers)===null||s===void 0?void 0:s.hilite)}else a=So(i[n.brush],l,o,c);return a.setAttribute("cgHash",r),a}function Co(e,n,o){const[r,i]=$(n,o),t=I(T("g"),{transform:`translate(${r},${i})`}),c=I(T("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return t.appendChild(c),c.innerHTML=e,t}function So(e,n,o,r){const i=$(n,r),t=Ao(),c=(r.width+r.height)/(4*Math.max(r.width,r.height));return I(T("circle"),{stroke:e.color,"stroke-width":t[o?0:1],fill:"none",opacity:on(e,o),cx:i[0],cy:i[1],r:c-t[1]/2})}function Mo(e,n,o,r,i,t,c=!1){function s(l){const g=Oo(i&&!r),u=$(n,t),b=$(o,t),S=b[0]-u[0],f=b[1]-u[1],p=Math.atan2(f,S),M=Math.cos(p)*g,h=Math.sin(p)*g;return I(T("line"),{stroke:l?"white":e.color,"stroke-width":Do(e,r)+(l?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${l?"hilite":e.key})`,opacity:l?1:on(e,r),x1:u[0],y1:u[1],x2:b[0]-M,y2:b[1]-h})}const a=c?T("g"):s(!1);return c&&[!0,!1].map(l=>a.appendChild(s(l))),a}function xo(e){const n=I(T("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:e.key==="hilite"?1.86:2.05,refY:2});return n.appendChild(I(T("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function I(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function Me(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function nn(e,n){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}}function Ao(){return[3/64,4/64]}function Do(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function on(e,n){return(e.opacity||1)*(n?.9:1)}function Oo(e){return(e?20:10)/64}function $(e,n){const o=Math.min(1,n.width/n.height),r=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function To(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const a of On)e.classList.toggle("orientation-"+a,n.orientation===a);e.classList.toggle("manipulable",!n.viewOnly);const o=N("cg-container");e.appendChild(o);const r=N("cg-board");o.appendChild(r);let i,t,c;if(n.drawable.visible&&(i=I(T("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(T("defs")),i.appendChild(T("g")),t=I(T("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(T("g")),c=N("cg-auto-pieces"),o.appendChild(i),o.appendChild(t),o.appendChild(c)),n.coordinates){const a=n.orientation==="black"?" black":"",l=n.ranksPosition==="left"?" left":"";o.appendChild(xe(le,"ranks"+a+l)),o.appendChild(xe(ce,"files"+a))}let s;return n.draggable.enabled&&n.draggable.showGhost&&(s=N("piece","ghost"),de(s,!1),o.appendChild(s)),{board:r,container:o,wrap:e,ghost:s,svg:i,customSvg:t,autoPieces:c}}function xe(e,n){const o=N("coords",n);let r;for(const i of e)r=N("coord"),r.textContent=i,o.appendChild(r);return o}function _o(e,n){if(!e.dropmode.active)return;L(e),R(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=j(n),i=r&&z(r,C(e),e.dom.bounds());i&&Ve(e,"a0",i)}e.dom.redraw()}function qo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Ko(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1})}function No(e,n){const o=[];if("ResizeObserver"in window||o.push(G(document.body,"chessground.resize",n)),!e.viewOnly){const r=Ae(e,po,io),i=Ae(e,ho,to);for(const c of["touchmove","mousemove"])o.push(G(document,c,r));for(const c of["touchend","mouseup"])o.push(G(document,c,i));const t=()=>e.dom.bounds.clear();o.push(G(document,"scroll",t,{capture:!0,passive:!0})),o.push(G(window,"resize",t,{passive:!0}))}return()=>o.forEach(r=>r())}function G(e,n,o,r){return e.addEventListener(n,o,r),()=>e.removeEventListener(n,o,r)}const Ko=e=>n=>{e.draggable.current?J(e):e.drawable.current?Qe(e):n.shiftKey||qe(n)?e.drawable.enabled&&ro(e,n):e.viewOnly||(e.dropmode.active?_o(e,n):ao(e,n))},Ae=(e,n,o)=>r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||n(e,r)};function Eo(e){const n=C(e),o=Q(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,t=e.animation.current,c=t?t.plan.anims:new Map,s=t?t.plan.fadings:new Map,a=e.draggable.current,l=Lo(e),g=new Set,u=new Set,b=new Map,S=new Map;let f,p,M,h,P,m,y,x,U,F;for(p=r.firstChild;p;){if(f=p.cgKey,rn(p))if(M=i.get(f),P=c.get(f),m=s.get(f),h=p.cgPiece,p.cgDragging&&(!a||a.orig!==f)&&(p.classList.remove("dragging"),q(p,o(w(f),n)),p.cgDragging=!1),!m&&p.cgFading&&(p.cgFading=!1,p.classList.remove("fading")),M){if(P&&p.cgAnimating&&h===X(M)){const v=w(f);v[0]+=P[2],v[1]+=P[3],p.classList.add("anim"),q(p,o(v,n))}else p.cgAnimating&&(p.cgAnimating=!1,p.classList.remove("anim"),q(p,o(w(f),n)),e.addPieceZIndex&&(p.style.zIndex=ne(w(f),n)));h===X(M)&&(!m||!p.cgFading)?g.add(f):m&&h===X(m)?(p.classList.add("fading"),p.cgFading=!0):oe(b,h,p)}else oe(b,h,p);else if(tn(p)){const v=p.className;l.get(f)===v?u.add(f):oe(S,v,p)}p=p.nextSibling}for(const[v,W]of l)if(!u.has(v)){U=S.get(W),F=U&&U.pop();const A=o(w(v),n);if(F)F.cgKey=v,q(F,A);else{const D=N("square",W);D.cgKey=v,q(D,A),r.insertBefore(D,r.firstChild)}}for(const[v,W]of i)if(P=c.get(v),!g.has(v))if(y=b.get(X(W)),x=y&&y.pop(),x){x.cgKey=v,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const A=w(v);e.addPieceZIndex&&(x.style.zIndex=ne(A,n)),P&&(x.cgAnimating=!0,x.classList.add("anim"),A[0]+=P[2],A[1]+=P[3]),q(x,o(A,n))}else{const A=X(W),D=N("piece",A),Z=w(v);D.cgPiece=A,D.cgKey=v,P&&(D.cgAnimating=!0,Z[0]+=P[2],Z[1]+=P[3]),q(D,o(Z,n)),e.addPieceZIndex&&(D.style.zIndex=ne(Z,n)),r.appendChild(D)}for(const v of b.values())Oe(e,v);for(const v of S.values())Oe(e,v)}function Io(e){const n=C(e),o=Q(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(rn(r)&&!r.cgAnimating||tn(r))&&q(r,o(w(r.cgKey),n)),r=r.nextSibling}function De(e){var n,o;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,t=r.height/r.width,c=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=c*t;i.style.width=c+"px",i.style.height=s+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-width",c+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",s+"px")}const rn=e=>e.tagName==="PIECE",tn=e=>e.tagName==="SQUARE";function Oe(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function ne(e,n){const r=e[1];return`${n?3+7-r:3+r}`}const X=e=>`${e.color} ${e.role}`;function Lo(e){var n;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)K(o,t,"last-move");if(e.check&&e.highlight.check&&K(o,e.check,"check"),e.selected&&(K(o,e.selected,"selected"),e.movable.showDests)){const t=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(t)for(const s of t)K(o,s,"move-dest"+(e.pieces.has(s)?" oc":""));const c=e.premovable.dests;if(c)for(const s of c)K(o,s,"premove-dest"+(e.pieces.has(s)?" oc":""))}const r=e.premovable.current;if(r)for(const t of r)K(o,t,"current-premove");else e.predroppable.current&&K(o,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const t of i.keys)K(o,t,"exploding"+i.stage);return o}function K(e,n,o){const r=e.get(n);r?e.set(n,`${r} ${o}`):e.set(n,o)}function oe(e,n,o){const r=e.get(n);r?r.push(o):e.set(n,[o])}function Ro(e,n){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Ho(i),current:!1}));te(r,n,i=>Bo(e,i,e.dom.bounds()))}function Wo(e){var n;const o=C(e),r=Q(e.dom.bounds());let i=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;i;)_e(i,r(w(i.cgKey),o),i.cgScale),i=i.nextSibling}function Bo(e,{shape:n,hash:o},r){var i,t,c;const s=n.orig,a=(i=n.piece)===null||i===void 0?void 0:i.role,l=(t=n.piece)===null||t===void 0?void 0:t.color,g=(c=n.piece)===null||c===void 0?void 0:c.scale,u=N("piece",`${a} ${l}`);return u.setAttribute("cgHash",o),u.cgKey=s,u.cgScale=g,_e(u,Q(r)(w(s),C(e)),g),u}const Ho=e=>{var n,o,r;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function Vo(e,n){const o=vo();Ge(o,n||{});function r(){const i="dom"in o?o.dom.unbind:void 0,t=To(e,o),c=_n(()=>t.board.getBoundingClientRect()),s=g=>{Eo(l),t.autoPieces&&Ro(l,t.autoPieces),!g&&t.svg&&bo(l,t.svg,t.customSvg)},a=()=>{De(l),Io(l),t.autoPieces&&Wo(l)},l=o;return l.dom={elements:t,bounds:c,redraw:jo(s),redrawNow:s,unbind:i},l.drawable.prevSvgHash="",De(l),s(!1),qo(l,a),i||(l.dom.unbind=No(l,a)),l.events.insert&&l.events.insert(t),l}return mo(r(),r)}function jo(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}function zo(e){let n,o;return{c(){n=Cn("div"),this.h()},l(r){n=Sn(r,"DIV",{class:!0}),Mn(n).forEach(ve),this.h()},h(){be(n,"class",o="cg-wrap "+e[0]+" svelte-d0p6kd")},m(r,i){xn(r,n,i),e[36](n)},p(r,i){i[0]&1&&o!==(o="cg-wrap "+r[0]+" svelte-d0p6kd")&&be(n,"class",o)},i:we,o:we,d(r){r&&ve(n),e[36](null)}}}function Fo(e,n,o){let{className:r="cg-default-style"}=n,{fen:i=void 0}=n,{orientation:t=void 0}=n,{turnColor:c=void 0}=n,{check:s=void 0}=n,{lastMove:a=void 0}=n,{selected:l=void 0}=n,{coordinates:g=void 0}=n,{autoCastle:u=void 0}=n,{viewOnly:b=void 0}=n,{disableContextMenu:S=void 0}=n,{addPieceZIndex:f=void 0}=n,{addDimensionsCssVarsTo:p=void 0}=n,{blockTouchScroll:M=void 0}=n,{config:h={}}=n,P,m;An(async()=>{t!==void 0&&o(2,h.orientation=t,h),i!==void 0&&o(2,h.fen=i,h),c!==void 0&&o(2,h.turnColor=c,h),s!==void 0&&o(2,h.check=s,h),a!==void 0&&o(2,h.lastMove=a,h),l!==void 0&&o(2,h.selected=l,h),g!==void 0&&o(2,h.coordinates=g,h),u!==void 0&&o(2,h.autoCastle=u,h),b!==void 0&&o(2,h.viewOnly=b,h),S!==void 0&&o(2,h.disableContextMenu=S,h),f!==void 0&&o(2,h.addPieceZIndex=f,h),p!==void 0&&o(2,h.addDimensionsCssVarsTo=p,h),M!==void 0&&o(2,h.blockTouchScroll=M,h),m=Vo(P,h)});function y(d){m&&m.set(d)}function x(d){m.set(d)}function U(){return m.state}function F(){return m.getFen()}function v(){return m.toggleOrientation()}function W(d,B){return m.move(d,B)}function A(d){return m.setPieces(d)}function D(d,B){return m.selectSquare(d,B)}function Z(d,B){return m.newPiece(d,B)}function cn(){return m.playPremove()}function ln(){m.cancelPremove()}function sn(d){return m.playPredrop(d)}function an(){m.cancelPredrop()}function dn(){m.cancelMove()}function un(){m.stop()}function fn(d){m.explode(d)}function pn(d){m.setShapes(d)}function hn(d){m.setAutoShapes(d)}function gn(){return m.redrawAll()}function mn(d,B,wn){m.dragNewPiece(d,B,wn)}function vn(){return m.destroy()}function bn(d){Dn[d?"unshift":"push"](()=>{P=d,o(1,P)})}return e.$$set=d=>{"className"in d&&o(0,r=d.className),"fen"in d&&o(3,i=d.fen),"orientation"in d&&o(4,t=d.orientation),"turnColor"in d&&o(5,c=d.turnColor),"check"in d&&o(6,s=d.check),"lastMove"in d&&o(7,a=d.lastMove),"selected"in d&&o(8,l=d.selected),"coordinates"in d&&o(9,g=d.coordinates),"autoCastle"in d&&o(10,u=d.autoCastle),"viewOnly"in d&&o(11,b=d.viewOnly),"disableContextMenu"in d&&o(12,S=d.disableContextMenu),"addPieceZIndex"in d&&o(13,f=d.addPieceZIndex),"addDimensionsCssVarsTo"in d&&o(14,p=d.addDimensionsCssVarsTo),"blockTouchScroll"in d&&o(15,M=d.blockTouchScroll),"config"in d&&o(2,h=d.config)},e.$$.update=()=>{e.$$.dirty[0]&8&&y({fen:i}),e.$$.dirty[0]&16&&y({orientation:t}),e.$$.dirty[0]&32&&y({turnColor:c}),e.$$.dirty[0]&64&&y({check:s}),e.$$.dirty[0]&128&&y({lastMove:a}),e.$$.dirty[0]&256&&y({selected:l}),e.$$.dirty[0]&512&&y({coordinates:g}),e.$$.dirty[0]&1024&&y({autoCastle:u}),e.$$.dirty[0]&2048&&y({viewOnly:b}),e.$$.dirty[0]&4096&&y({disableContextMenu:S}),e.$$.dirty[0]&8192&&y({addPieceZIndex:f}),e.$$.dirty[0]&16384&&y({addDimensionsCssVarsTo:p}),e.$$.dirty[0]&32768&&y({blockTouchScroll:M}),e.$$.dirty[0]&4&&y(h)},[r,P,h,i,t,c,s,a,l,g,u,b,S,f,p,M,x,U,F,v,W,A,D,Z,cn,ln,sn,an,dn,un,fn,pn,hn,gn,mn,vn,bn]}class Uo extends yn{constructor(n){super(),Pn(this,n,Fo,zo,kn,{className:0,fen:3,orientation:4,turnColor:5,check:6,lastMove:7,selected:8,coordinates:9,autoCastle:10,viewOnly:11,disableContextMenu:12,addPieceZIndex:13,addDimensionsCssVarsTo:14,blockTouchScroll:15,config:2,set:16,getState:17,getFen:18,toggleOrientation:19,move:20,setPieces:21,selectSquare:22,newPiece:23,playPremove:24,cancelPremove:25,playPredrop:26,cancelPredrop:27,cancelMove:28,stop:29,explode:30,setShapes:31,setAutoShapes:32,redrawAll:33,dragNewPiece:34,destroy:35},null,[-1,-1])}get set(){return this.$$.ctx[16]}get getState(){return this.$$.ctx[17]}get getFen(){return this.$$.ctx[18]}get toggleOrientation(){return this.$$.ctx[19]}get move(){return this.$$.ctx[20]}get setPieces(){return this.$$.ctx[21]}get selectSquare(){return this.$$.ctx[22]}get newPiece(){return this.$$.ctx[23]}get playPremove(){return this.$$.ctx[24]}get cancelPremove(){return this.$$.ctx[25]}get playPredrop(){return this.$$.ctx[26]}get cancelPredrop(){return this.$$.ctx[27]}get cancelMove(){return this.$$.ctx[28]}get stop(){return this.$$.ctx[29]}get explode(){return this.$$.ctx[30]}get setShapes(){return this.$$.ctx[31]}get setAutoShapes(){return this.$$.ctx[32]}get redrawAll(){return this.$$.ctx[33]}get dragNewPiece(){return this.$$.ctx[34]}get destroy(){return this.$$.ctx[35]}}export{Uo as C,Vo as a};
